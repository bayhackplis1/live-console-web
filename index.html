<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antuan</title>
    <style>
        body {
            background-color: black;
            color: crimson;
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 0;
            overflow: hidden;
            position: relative;
        }
        h1 {
            color: crimson;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 20px;
            position: relative;
            z-index: 3; /* Encima de todo */
        }
        #chat {
            background-color: rgba(0, 0, 0, 0.8);
            color: crimson;
            padding: 15px;
            border: 2px solid crimson;
            border-radius: 5px;
            height: 60vh;
            overflow-y: auto;
            font-size: 1.2em;
            white-space: pre-wrap;
            word-wrap: break-word;
            position: relative;
            z-index: 3; /* Encima de todo */
        }
        #message-input {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background-color: black;
            color: crimson;
            border: 2px solid crimson;
            border-radius: 5px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.2em;
            position: relative;
            z-index: 3; /* Encima de todo */
        }
        .message {
            margin-bottom: 10px;
        }
        .system-message {
            color: darkred;
        }
        .admin-message {
            color: firebrick;
        }
        /* Efecto Matrix sangriento */
        .blood-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1; /* Debajo de la interfaz */
        }
        .blood-effect span {
            position: absolute;
            top: -50px;
            color: crimson;
            font-size: 1.2em;
            writing-mode: vertical-rl;
            text-orientation: upright;
            animation: fall linear infinite;
            text-shadow: 0 0 5px darkred, 0 0 10px darkred, 0 0 20px darkred;
        }
        @keyframes fall {
            to {
                top: 100%;
            }
        }
        /* Efecto de sangre goteando */
        .blood-drop {
            position: absolute;
            width: 2px;
            height: 10px;
            background: crimson;
            animation: drip linear infinite;
            opacity: 0.8;
        }
        @keyframes drip {
            0% {
                top: -10px;
                opacity: 0.8;
            }
            50% {
                opacity: 1;
            }
            100% {
                top: 100%;
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <h1>Antuan</h1>
    <div id="chat"></div>
    <input type="text" id="message-input" placeholder="Escribe tu mensaje..." disabled>
    <div class="blood-effect" id="blood-effect"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const chat = document.getElementById('chat');
        const messageInput = document.getElementById('message-input');
        const bloodEffect = document.getElementById('blood-effect');

        // Función para generar un color hexadecimal aleatorio
        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        // Solicitar nombre de usuario al conectarse
        let username = '';
        while (!username) {
            username = prompt('Ingresa tu nombre de usuario:');
        }
        socket.emit('set username', username);

        // Habilitar el campo de mensaje después de ingresar el nombre
        messageInput.disabled = false;

        // Escuchar mensajes del servidor
        socket.on('chat message', (data) => {
            const messageElement = document.createElement('div');
            messageElement.className = 'message';

            // Asignar color aleatorio al mensaje
            messageElement.style.color = getRandomColor();

            // Asignar estilo según el tipo de mensaje
            if (data.type === 'system') {
                messageElement.classList.add('system-message');
            } else if (data.type === 'admin') {
                messageElement.classList.add('admin-message');
            }

            messageElement.textContent = data.text;
            chat.appendChild(messageElement);
            chat.scrollTop = chat.scrollHeight;
        });

        // Enviar mensaje al presionar Enter
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const message = messageInput.value.trim();
                if (message) {
                    socket.emit('chat message', { text: `[${username}]: ${message}`, type: 'user' });
                    messageInput.value = '';
                }
            }
        });

        // Generar efecto Matrix sangriento
        function createBloodEffect() {
            const characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
            const columns = Math.floor(window.innerWidth / 20);

            for (let i = 0; i < columns; i++) {
                const span = document.createElement('span');
                span.style.left = `${i * 20}px`;
                span.style.animationDuration = `${Math.random() * 2 + 1}s`;
                span.textContent = characters[Math.floor(Math.random() * characters.length)];
                bloodEffect.appendChild(span);

                // Añadir gotas de sangre
                const drop = document.createElement('div');
                drop.className = 'blood-drop';
                drop.style.left = `${i * 20 + 10}px`;
                drop.style.animationDuration = `${Math.random() * 2 + 1}s`;
                bloodEffect.appendChild(drop);
            }
        }

        // Iniciar efecto Matrix sangriento
        createBloodEffect();
    </script>
</body>
</html>
